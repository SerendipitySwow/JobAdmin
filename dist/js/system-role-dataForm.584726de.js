(window.webpackJsonp=window.webpackJsonp||[]).push([["system-role-dataForm"],{"0a4f":function(e,t,n){"use strict";n.r(t);n("b0c0");var r=n("7a23"),o=Object(r.createTextVNode)("展开/折叠"),a=Object(r.createTextVNode)("全选/全不选"),c=Object(r.createTextVNode)("取 消"),l=Object(r.createTextVNode)("保 存");var i=n("1da1"),d=(n("d3b7"),n("159b"),n("96cf"),{emits:["success"],data:function(){return{visible:!1,isSaveing:!1,loading:!1,form:{id:null,name:null,code:null,data_scope:"0",dept_ids:null},defaultProps:{children:"children",label:"label"},deptList:[],scopes:[{value:"0",label:"全部数据权限"},{value:"1",label:"自定义数据权限"},{value:"2",label:"本部门数据权限"},{value:"3",label:"本部门及以下数据权限"},{value:"4",label:"本人数据权限"}]}},methods:{open:function(){return this.visible=!0,this.loading=!0,this},submit:function(){var e=this;this.$refs.dialogForm.validate(function(){var t=Object(i.a)(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=10;break}return e.isSaveing=!0,"1"==e.form.data_scope&&(e.form.dept_ids=e.getTreeSelectNodes()),t.next=5,e.$API.role.update(e.form.id,e.form);case 5:r=t.sent,e.isSaveing=!1,r.success?(e.visible=!1,e.$emit("success",e.form),e.$message.success(r.message)):e.$alert(r.message,"提示",{type:"error"}),t.next=11;break;case 10:return t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getTreeSelectNodes:function(){var e=this.$refs.tree.getCheckedKeys(),t=this.$refs.tree.getHalfCheckedKeys();return e.unshift.apply(e,t),e},handleChangeScope:function(e){"1"!==e&&this.$refs.tree&&this.$refs.tree.setCheckedKeys([])},handleTreeExpand:function(e){var t=this;this.deptList.forEach((function(n){t.$refs.tree.store.nodesMap[n.id].expanded=e}))},handleTreeAll:function(e){this.$refs.tree.setCheckedNodes(e?this.deptList:[])},setData:function(e){var t=this;return Object(i.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.form.id=e.id,t.form.name=e.name,t.form.code=e.code,t.form.data_scope=e.data_scope,n.next=6,t.$API.dept.tree(e.id).then((function(e){t.deptList=e.data}));case 6:if("1"!==e.data_scope){n.next=9;break}return n.next=9,t.$API.role.getDeptByRole(e.id).then((function(e){e.data[0]&&e.data[0].depts&&e.data[0].depts.forEach((function(e){t.$refs.tree.setChecked(e.id,!0,!1)}))}));case 9:t.loading=!1;case 10:case"end":return n.stop()}}),n)})))()}}}),s=n("6b0d");const u=n.n(s)()(d,[["render",function(e,t,n,i,d,s){var u=Object(r.resolveComponent)("el-input"),f=Object(r.resolveComponent)("el-form-item"),b=Object(r.resolveComponent)("el-option"),p=Object(r.resolveComponent)("el-select"),m=Object(r.resolveComponent)("el-checkbox"),h=Object(r.resolveComponent)("el-tree"),j=Object(r.resolveComponent)("el-form"),O=Object(r.resolveComponent)("el-button"),v=Object(r.resolveComponent)("el-dialog"),g=Object(r.resolveDirective)("loading");return Object(r.openBlock)(),Object(r.createBlock)(v,{title:"数据权限",modelValue:d.visible,"onUpdate:modelValue":t[7]||(t[7]=function(e){return d.visible=e}),width:500,"destroy-on-close":""},{footer:Object(r.withCtx)((function(){return[Object(r.createVNode)(O,{onClick:t[5]||(t[5]=function(e){return d.visible=!1})},{default:Object(r.withCtx)((function(){return[c]})),_:1}),Object(r.createVNode)(O,{type:"primary",loading:d.isSaveing,onClick:t[6]||(t[6]=function(e){return s.submit()})},{default:Object(r.withCtx)((function(){return[l]})),_:1},8,["loading"])]})),default:Object(r.withCtx)((function(){return[Object(r.createVNode)(j,{model:d.form,ref:"dialogForm","label-width":"80px"},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(f,{label:"角色名称",prop:"name"},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(u,{modelValue:d.form.name,"onUpdate:modelValue":t[0]||(t[0]=function(e){return d.form.name=e}),size:"small",disabled:!0,clearable:"",placeholder:"请输入角色名称"},null,8,["modelValue"])]})),_:1}),Object(r.createVNode)(f,{label:"代码",prop:"code"},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(u,{modelValue:d.form.code,"onUpdate:modelValue":t[1]||(t[1]=function(e){return d.form.code=e}),size:"small",disabled:!0,clearable:"",placeholder:"请输入角色代码"},null,8,["modelValue"])]})),_:1}),Object(r.createVNode)(f,{label:"数据边界"},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(p,{modelValue:d.form.data_scope,"onUpdate:modelValue":t[2]||(t[2]=function(e){return d.form.data_scope=e}),size:"small",placeholder:"请选择数据权限边界",onChange:s.handleChangeScope},{default:Object(r.withCtx)((function(){return[(Object(r.openBlock)(!0),Object(r.createElementBlock)(r.Fragment,null,Object(r.renderList)(d.scopes,(function(e){return Object(r.openBlock)(),Object(r.createBlock)(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","onChange"])]})),_:1}),"1"===d.form.data_scope?Object(r.withDirectives)((Object(r.openBlock)(),Object(r.createBlock)(f,{key:0,label:"角色权限",prop:"dept_ids","element-loading-background":"rgba(255, 255, 255, 0.8)","element-loading-text":"数据加载中..."},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(m,{onChange:t[3]||(t[3]=function(e){return s.handleTreeExpand(e)})},{default:Object(r.withCtx)((function(){return[o]})),_:1}),Object(r.createVNode)(m,{onChange:t[4]||(t[4]=function(e){return s.handleTreeAll(e)})},{default:Object(r.withCtx)((function(){return[a]})),_:1}),Object(r.createVNode)(h,{class:"ma-tree-border",ref:"tree",data:d.deptList,"show-checkbox":"","node-key":"id","empty-text":"加载数据中...",props:d.defaultProps},null,8,["data","props"])]})),_:1},512)),[[g,d.loading]]):Object(r.createCommentVNode)("",!0)]})),_:1},8,["model"])]})),_:1},8,["modelValue"])}]]);t.default=u}}]);