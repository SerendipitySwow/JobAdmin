(window.webpackJsonp=window.webpackJsonp||[]).push([["system-attachment-mixins"],{"002b":function(e,t,n){"use strict";n.r(t);var a=n("1da1"),r=(n("96cf"),n("d81d"),n("4de4"),n("d3b7"),n("b0c0"),n("a15b"),n("2ef0"));t.default={computed:{preview:function(){var e=this;return this.dataList.filter((function(e){return e.mime_type.indexOf("image")>-1})).map((function(t){return e.viewImage(t.url)}))}},data:function(){return{dialog:{save:!1},dialogVisible:!1,povpoerShow:!1,showDirloading:!1,showFileloading:!0,filterText:"",dateRange:"",dataList:[],checkList:[],pageInfo:{total:0},storageMode:[{label:"本地存储",value:1},{label:"阿里云OSS存储",value:2},{label:"七牛云存储",value:3},{label:"腾讯COS存储",value:4}],queryParams:{storage_mode:void 0,origin_name:void 0,storage_path:void 0,maxDate:void 0,minDate:void 0,pageSize:30,page:1},isRecycle:!1,dirs:[],record:{url:""},props:{label:"name",children:"children",isLeaf:"leaf"}}},created:function(){this.loadDirs(),this.getList()},methods:{getList:function(){var e=this;this.showFileloading=!0,this.isRecycle?this.$API.attachment.getRecyclePageList(this.queryParams).then((function(t){e.dataList=t.data.items,e.pageInfo=t.data.pageInfo,e.showFileloading=!1})):this.$API.attachment.getPageList(this.queryParams).then((function(t){e.dataList=t.data.items,e.pageInfo=t.data.pageInfo,e.showFileloading=!1}))},loadNode:function(e,t){var n=this;return Object(a.a)(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0===e.data.name){a.next=10;break}return a.next=3,n.loadDirs(e.data.name);case 3:if(!((r=a.sent).length<1)){a.next=9;break}return n.$message.info("没有子目录"),a.abrupt("return",t([]));case 9:return a.abrupt("return",t(r));case 10:case"end":return a.stop()}}),a)})))()},loadDirs:function(){var e=arguments,t=this;return Object(a.a)(regeneratorRuntime.mark((function n(){var a,r,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:"/",n.next=3,t.$API.upload.getDirectory({path:a});case 3:if(!((r=n.sent).data.length<0)){n.next=6;break}return n.abrupt("return",[]);case 6:if(!r.success){n.next=17;break}if("/"!==a){n.next=13;break}return t.dirs=r.data.map((function(e){return{name:e.basename,leaf:!1,children:[]}})),t.dirs.unshift({name:"所有目录文件",leaf:!0,children:[]}),n.abrupt("return",[]);case 13:return s=r.data.map((function(e){return{name:e.basename,leaf:!1,children:[]}})),n.abrupt("return",s);case 15:n.next=19;break;case 17:return t.$message.error("获取目录列表失败"),n.abrupt("return",[]);case 19:case"end":return n.stop()}}),n)})))()},dirFilterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},dirClick:function(e){if(this.queryParams.storage_path!=e.name){if("所有目录文件"==e.name)return this.queryParams.storage_path=void 0,void this.getList();this.queryParams.storage_path=e.name,this.getList()}},add:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.dialog.save=!0,this.$nextTick((function(){e.$refs.dirDialog.open(t)}))},handleDeleteDir:function(e,t){var n=this;this.$confirm("确定删除 ".concat(e.name," 目录吗？"),"提示",{type:"warning"}).then(Object(a.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.$API.upload.deleteUploadDir({name:n.getParentName(t)}).then(function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.success){e.next=6;break}return e.next=3,n.loadDirs();case 3:n.$message.success(t.message),e.next=7;break;case 6:n.$message.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){n.$message.error(e)}));case 2:case"end":return e.stop()}}),e)}))))},getParentName:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t=e.level>1&&e.parent?this.getParentName(e.parent,e.data.name):""==t?e.data.name:e.data.name+"/"+t},handleDirSuccess:function(){this.loadDirs()},batchDel:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$confirm("确定删除选中的 ".concat(e.checkList.length," 项吗？"),"提示",{type:"warning"}).then((function(){var t=[];e.checkList.map((function(e){return t.push(e.id)})),e.isRecycle?e.$API.attachment.realDeletes(t.join(",")).then((function(t){t.success?(e.getList(),e.$message.success(t.message)):e.$message.error(t.message)})):e.$API.attachment.deletes(t.join(",")).then((function(t){t.success?(e.getList(),e.$message.success(t.message)):e.$message.error(t.message)}))}));case 2:case"end":return t.stop()}}),t)})))()},deletes:function(e){var t=this;return Object(a.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$confirm("确定删除该数据吗？","提示",{type:"warning"}).then((function(){t.isRecycle?t.$API.attachment.realDeletes(e).then((function(e){e.success?(t.getList(),t.$message.success(e.message)):t.$message.error(e.message)})):t.$API.attachment.deletes(e).then((function(e){e.success?(t.getList(),t.$message.success(e.message)):t.$message.error(e.message)}))})).catch((function(){}));case 2:case"end":return n.stop()}}),n)})))()},recovery:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],e.checkList.map((function(e){return n.push(e.id)})),t.next=4,e.$API.attachment.recoverys(n.join(",")).then((function(t){t.success?(e.$message.success(t.message),e.getList()):e.$message.error(t.message)}));case 4:case"end":return t.stop()}}),t)})))()},handleDateChange:function(e){null!==e&&(this.queryParams.minDate=e[0],this.queryParams.maxDate=e[1])},handlerSearch:function(){this.getList()},switchData:function(){this.isRecycle=!this.isRecycle,this.getList()},resetSearch:function(){this.queryParams={storage_mode:void 0,storage_path:void 0,origin_name:void 0,maxDate:void 0,minDate:void 0}},handleSuccess:function(){this.getList()},selectAdd:function(e){this.checkList=Object(r.xor)(this.checkList,[e])},selectAll:function(){this.checkList=Object(r.union)(this.checkList,this.dataList)},selectInvert:function(){this.checkList=Object(r.xor)(this.checkList,this.dataList)}},watch:{filterText:function(e){this.$refs.dirs.filter(e)}}}}}]);