(window.webpackJsonp=window.webpackJsonp||[]).push([["setting-crontab","setting-crontab-logs","setting-crontab-save"],{"0771":function(e,t,n){"use strict";n.r(t);var o=n("7a23"),c=Object(o.createTextVNode)("删除"),r={key:0,style:{color:"#67C23A"}},l=[Object(o.createElementVNode)("i",{class:"el-icon-success"},null,-1),Object(o.createTextVNode)(" 成功")],a={key:1,style:{color:"#F56C6C"}},i=[Object(o.createElementVNode)("i",{class:"el-icon-error"},null,-1),Object(o.createTextVNode)(" 异常")],u=Object(o.createTextVNode)("查看");var s=n("1da1"),d=(n("96cf"),n("d81d"),n("a15b"),{data:function(){return{selection:[],logsVisible:!1,api:{list:this.$API.crontab.getLogPageList},queryParams:{crontab_id:void 0},log:"",crontab_id:""}},methods:{show:function(e){this.logsVisible=!0,this.log=e.exception_info},setData:function(e){this.crontab_id=e.id,this.queryParams.crontab_id=e.id,this.$refs.table.upData(this.queryParams)},batchDel:function(){var e=this;return Object(s.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$confirm("确定删除选中的 ".concat(e.selection.length," 项吗？"),"提示",{type:"warning"}).then((function(){var t=e.$loading(),n=[];e.selection.map((function(e){return n.push(e.id)})),e.$API.crontab.deleteLog(n.join(",")).then((function(){e.$refs.table.upData({crontab_id:e.crontab_id})})),t.close(),e.$message.success("操作成功")}));case 2:case"end":return t.stop()}}),t)})))()},selectionChange:function(e){this.selection=e}}}),b=(n("57fa"),n("6b0d"));const f=n.n(b)()(d,[["render",function(e,t,n,s,d,b){var f=Object(o.resolveComponent)("el-button"),m=Object(o.resolveComponent)("el-table-column"),j=Object(o.resolveComponent)("maTable"),O=Object(o.resolveComponent)("el-main"),p=Object(o.resolveComponent)("el-drawer"),V=Object(o.resolveComponent)("el-container"),h=Object(o.resolveDirective)("auth");return Object(o.openBlock)(),Object(o.createBlock)(V,null,{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(O,{style:{padding:"0 20px"}},{default:Object(o.withCtx)((function(){return[Object(o.withDirectives)(Object(o.createVNode)(f,{type:"danger",plain:"",icon:"el-icon-delete",disabled:0==d.selection.length,onClick:b.batchDel},{default:Object(o.withCtx)((function(){return[c]})),_:1},8,["disabled","onClick"]),[[h,["system:crontab:deleteLog"]]]),Object(o.createVNode)(j,{ref:"table","row-key":"id",api:d.api,autoLoad:!1,params:{orderBy:"created_at",orderType:"desc"},onSelectionChange:b.selectionChange,stripe:""},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(m,{type:"selection",width:"50"}),Object(o.createVNode)(m,{label:"执行时间",prop:"created_at",width:"160"}),Object(o.createVNode)(m,{label:"执行结果",prop:"state",width:"80"},{default:Object(o.withCtx)((function(e){return["0"==e.row.status?(Object(o.openBlock)(),Object(o.createElementBlock)("span",r,l)):(Object(o.openBlock)(),Object(o.createElementBlock)("span",a,i))]})),_:1}),Object(o.createVNode)(m,{label:"执行目标",prop:"target",width:"200","show-overflow-tooltip":!0}),Object(o.createVNode)(m,{label:"异常信息",prop:"logs",width:"100",fixed:"right"},{default:Object(o.withCtx)((function(e){return[Object(o.createVNode)(f,{size:"mini",onClick:function(t){return b.show(e.row)},type:"text"},{default:Object(o.withCtx)((function(){return[u]})),_:2},1032,["onClick"])]})),_:1})]})),_:1},8,["api","onSelectionChange"])]})),_:1}),Object(o.createVNode)(p,{title:"异常信息",modelValue:d.logsVisible,"onUpdate:modelValue":t[0]||(t[0]=function(e){return d.logsVisible=e}),size:500,direction:"rtl","destroy-on-close":""},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(O,{style:{padding:"0 20px 20px 20px"}},{default:Object(o.withCtx)((function(){return[Object(o.createElementVNode)("pre",null,Object(o.toDisplayString)(""==d.log?"无异常信息":d.log),1)]})),_:1})]})),_:1},8,["modelValue"])]})),_:1})}]]);t.default=f},"57fa":function(e,t,n){"use strict";n("b471")},"5e5d":function(e,t,n){},"8e8d":function(e,t,n){"use strict";n("5e5d")},b471:function(e,t,n){},bcd3:function(e,t,n){"use strict";n.r(t);n("b0c0");var o=n("7a23"),c=Object(o.createTextVNode)(" Cron规则 "),r=Object(o.createTextVNode)(" 0ㅤ1ㅤ2ㅤ3ㅤ4ㅤ5"),l=Object(o.createElementVNode)("br",null,null,-1),a=Object(o.createTextVNode)(" *ㅤ*ㅤ*ㅤ*ㅤ*ㅤ* (执行)"),i=Object(o.createElementVNode)("br",null,null,-1),u=Object(o.createTextVNode)(" -ㅤ-ㅤ-ㅤ-ㅤ-ㅤ- (忽略)"),s=Object(o.createElementVNode)("br",null,null,-1),d=Object(o.createTextVNode)(" |ㅤ |ㅤ |ㅤ |ㅤ |ㅤ |"),b=Object(o.createElementVNode)("br",null,null,-1),f=Object(o.createTextVNode)(" |ㅤ |ㅤ |ㅤ |ㅤ |ㅤ +----- 天或者星期 (0 - 6) (星期天=0)"),m=Object(o.createElementVNode)("br",null,null,-1),j=Object(o.createTextVNode)(" |ㅤ |ㅤ |ㅤ |ㅤ +----- 月 (1 - 12)"),O=Object(o.createElementVNode)("br",null,null,-1),p=Object(o.createTextVNode)(" |ㅤ |ㅤ |ㅤ +------- 天 (1 - 31)"),V=Object(o.createElementVNode)("br",null,null,-1),h=Object(o.createTextVNode)(" |ㅤ |ㅤ +--------- 小时 (0 - 23)"),g=Object(o.createElementVNode)("br",null,null,-1),C=Object(o.createTextVNode)(" |ㅤ +----------- 分钟 (0 - 59)"),x=Object(o.createElementVNode)("br",null,null,-1),N=Object(o.createTextVNode)(" +------------- 秒 (0-59)"),v=Object(o.createElementVNode)("br",null,null,-1),w=Object(o.createTextVNode)("生成表达式"),k=Object(o.createTextVNode)("启用"),y=Object(o.createTextVNode)("停用"),_=Object(o.createTextVNode)("是"),E=Object(o.createTextVNode)("否"),T=Object(o.createTextVNode)("取 消"),$=Object(o.createTextVNode)("保 存");var B={emits:["success","closed"],components:{expression:n("1ce5").default},data:function(){return{mode:"add",titleMap:{add:"新增定时任务",edit:"编辑定时任务"},form:{id:"",name:"",type:"",target:"",parameter:"",rule:"",singleton:"1",status:"0",remark:""},rules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],type:[{required:!0,message:"请选择任务类型",trigger:"change"}],target:[{required:!0,message:"请输入任务调用目标",trigger:"blur"}],rule:[{required:!0,message:"请输入任务执行规则",trigger:"blur"}]},types:[{label:"command（命令任务）",value:"1"},{label:"class（类任务，执行类的execute方法）",value:"2"},{label:"url（执行url地址任务）",value:"3"},{label:"eval（PHP脚本任务，直接输入PHP脚本）",value:"4"}],visible:!1,isSaveing:!1}},methods:{open:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"add";return this.mode=e,this.visible=!0,this},submit:function(){var e=this;this.$refs.dialogForm.validate((function(t){t&&(e.isSaveing=!0,"add"==e.mode?e.$API.crontab.save(e.form).then((function(t){e.$message.success(t.message),e.isSaveing=!1,e.visible=!1,e.$emit("success")})):e.$API.crontab.update(e.form.id,e.form).then((function(t){e.$message.success(t.message),e.isSaveing=!1,e.visible=!1,e.$emit("success")})))}))},setData:function(e){this.form.id=e.id,this.form.name=e.name,this.form.type=e.type,this.form.target=e.target,this.form.parameter=e.parameter,this.form.rule=e.rule,this.form.singleton=e.singleton,this.form.status=e.status,this.form.remark=e.remark},openExpression:function(){this.$refs.expression.init()},updateExpression:function(e){this.form.rule=e}}},D=n("6b0d");const P=n.n(D)()(B,[["render",function(e,t,n,B,D,P){var S=Object(o.resolveComponent)("el-input"),L=Object(o.resolveComponent)("el-form-item"),U=Object(o.resolveComponent)("el-option"),q=Object(o.resolveComponent)("el-select"),I=Object(o.resolveComponent)("el-icon-question-filled"),A=Object(o.resolveComponent)("el-icon"),F=Object(o.resolveComponent)("el-tooltip"),z=Object(o.resolveComponent)("el-button"),R=Object(o.resolveComponent)("el-radio"),H=Object(o.resolveComponent)("el-radio-group"),J=Object(o.resolveComponent)("el-form"),M=Object(o.resolveComponent)("el-dialog"),G=Object(o.resolveComponent)("expression");return Object(o.openBlock)(),Object(o.createElementBlock)(o.Fragment,null,[Object(o.createVNode)(M,{title:D.titleMap[D.mode],modelValue:D.visible,"onUpdate:modelValue":t[10]||(t[10]=function(e){return D.visible=e}),width:550,"destroy-on-close":"",onClosed:t[11]||(t[11]=function(t){return e.$emit("closed")})},{footer:Object(o.withCtx)((function(){return[Object(o.createVNode)(z,{onClick:t[8]||(t[8]=function(e){return D.visible=!1})},{default:Object(o.withCtx)((function(){return[T]})),_:1}),Object(o.createVNode)(z,{type:"primary",loading:D.isSaveing,onClick:t[9]||(t[9]=function(e){return P.submit()})},{default:Object(o.withCtx)((function(){return[$]})),_:1},8,["loading"])]})),default:Object(o.withCtx)((function(){return[Object(o.createVNode)(J,{model:D.form,rules:D.rules,ref:"dialogForm","label-width":"105px"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(L,{label:"任务名称",prop:"name"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(S,{modelValue:D.form.name,"onUpdate:modelValue":t[0]||(t[0]=function(e){return D.form.name=e}),placeholder:"请输入任务名称",clearable:""},null,8,["modelValue"])]})),_:1}),Object(o.createVNode)(L,{label:"任务类型",prop:"type"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(q,{modelValue:D.form.type,"onUpdate:modelValue":t[1]||(t[1]=function(e){return D.form.type=e}),placeholder:"请选择任务类型",style:{width:"100%"}},{default:Object(o.withCtx)((function(){return[(Object(o.openBlock)(!0),Object(o.createElementBlock)(o.Fragment,null,Object(o.renderList)(D.types,(function(e){return Object(o.openBlock)(),Object(o.createBlock)(U,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(o.createVNode)(L,{label:"Cron规则",prop:"rule"},{label:Object(o.withCtx)((function(){return[c,Object(o.createVNode)(F,null,{content:Object(o.withCtx)((function(){return[r,l,a,i,u,s,d,b,f,m,j,O,p,V,h,g,C,x,N,v]})),default:Object(o.withCtx)((function(){return[Object(o.createVNode)(A,null,{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(I)]})),_:1})]})),_:1})]})),default:Object(o.withCtx)((function(){return[Object(o.createVNode)(S,{modelValue:D.form.rule,"onUpdate:modelValue":t[2]||(t[2]=function(e){return D.form.rule=e}),placeholder:"请输入Cron规则",clearable:""},{append:Object(o.withCtx)((function(){return[Object(o.createVNode)(z,{onClick:P.openExpression},{default:Object(o.withCtx)((function(){return[w]})),_:1},8,["onClick"])]})),_:1},8,["modelValue"])]})),_:1}),Object(o.createVNode)(L,{label:"调用目标",prop:"target"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(S,{type:"textarea",rows:3,placeholder:"调用目标",modelValue:D.form.target,"onUpdate:modelValue":t[3]||(t[3]=function(e){return D.form.target=e}),clearable:""},null,8,["modelValue"])]})),_:1}),Object(o.createVNode)(L,{label:"调用参数",prop:"parameter"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(S,{type:"textarea",rows:3,placeholder:"调用参数，url和eval任务参数无效",modelValue:D.form.parameter,"onUpdate:modelValue":t[4]||(t[4]=function(e){return D.form.parameter=e}),clearable:""},null,8,["modelValue"])]})),_:1}),Object(o.createVNode)(L,{label:"状态",prop:"status"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(H,{modelValue:D.form.status,"onUpdate:modelValue":t[5]||(t[5]=function(e){return D.form.status=e})},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(R,{label:"0"},{default:Object(o.withCtx)((function(){return[k]})),_:1}),Object(o.createVNode)(R,{label:"1"},{default:Object(o.withCtx)((function(){return[y]})),_:1})]})),_:1},8,["modelValue"])]})),_:1}),Object(o.createVNode)(L,{label:"单次执行",prop:"singleton"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(H,{modelValue:D.form.singleton,"onUpdate:modelValue":t[6]||(t[6]=function(e){return D.form.singleton=e})},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(R,{label:"0"},{default:Object(o.withCtx)((function(){return[_]})),_:1}),Object(o.createVNode)(R,{label:"1"},{default:Object(o.withCtx)((function(){return[E]})),_:1})]})),_:1},8,["modelValue"])]})),_:1}),Object(o.createVNode)(L,{label:"备注",prop:"remark"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(S,{type:"textarea",rows:3,placeholder:"备注信息",modelValue:D.form.remark,"onUpdate:modelValue":t[7]||(t[7]=function(e){return D.form.remark=e})},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model","rules"])]})),_:1},8,["title","modelValue"]),Object(o.createVNode)(G,{ref:"expression",onUpdate:P.updateExpression,expressionValue:D.form.rule},null,8,["onUpdate","expressionValue"])],64)}]]);t.default=P},e9c9:function(e,t,n){"use strict";n.r(t);n("b0c0");var o=n("7a23"),c=function(e){return Object(o.pushScopeId)("data-v-100d1068"),e=e(),Object(o.popScopeId)(),e},r=c((function(){return Object(o.createElementVNode)("h4",null,"调用目标",-1)})),l=c((function(){return Object(o.createElementVNode)("h4",null,"定时规则",-1)})),a={class:"bottom"},i={class:"state"},u=Object(o.createTextVNode)("正常"),s=Object(o.createTextVNode)("停用"),d={class:"handler"},b=Object(o.createTextVNode)("编辑"),f=Object(o.createTextVNode)("日志"),m=Object(o.createTextVNode)("删除"),j=c((function(){return Object(o.createElementVNode)("i",{class:"el-icon-plus"},null,-1)})),O=c((function(){return Object(o.createElementVNode)("p",null,"添加计划任务",-1)}));var p=n("1da1"),V=(n("96cf"),n("bcd3")),h=n("0771"),g={name:"setting:crontab",components:{saveDialog:V.default,logs:h.default},provide:function(){return{list:this.list}},data:function(){return{dialog:{save:!1,logsVisible:!1},queryParams:{},list:[],types:["","命令任务","类任务","URL任务","EVAL任务"]}},mounted:function(){this.loadData()},methods:{loadData:function(){var e=this;return Object(p.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$API.crontab.getPageList(e.queryParams).then((function(t){e.list=t.data}));case 2:case"end":return t.stop()}}),t)})))()},getTypeLabel:function(e){return this.types[e]},add:function(){var e=this;this.dialog.save=!0,this.$nextTick((function(){e.$refs.saveDialog.open()}))},edit:function(e){var t=this;this.dialog.save=!0,this.$nextTick((function(){t.$refs.saveDialog.open("edit").setData(e)}))},del:function(e){var t=this;this.$confirm("确认删除 ".concat(e.name," 定时任务吗？"),"提示",{type:"warning",confirmButtonText:"删除",confirmButtonClass:"el-button--danger"}).then((function(){t.$API.crontab.deletes(e.id).then((function(e){e.success?(t.$message.success(e.message),t.loadData()):t.$message.success(e.message)}))})).catch((function(){}))},logs:function(e){var t=this;this.dialog.logsVisible=!0,this.$nextTick((function(){t.$refs.logList.setData(e)}))},run:function(e){var t=this;this.$API.crontab.run({id:e.id}).then((function(){t.$message.success("已成功执行计划任务：".concat(e.name))}))},handleSuccess:function(e,t){this.loadData()}}},C=(n("8e8d"),n("6b0d"));const x=n.n(C)()(g,[["render",function(e,t,n,c,p,V){var h=Object(o.resolveComponent)("el-tag"),g=Object(o.resolveComponent)("el-button"),C=Object(o.resolveComponent)("el-popconfirm"),x=Object(o.resolveComponent)("el-dropdown-item"),N=Object(o.resolveComponent)("el-dropdown-menu"),v=Object(o.resolveComponent)("el-dropdown"),w=Object(o.resolveComponent)("el-card"),k=Object(o.resolveComponent)("el-col"),y=Object(o.resolveComponent)("el-row"),_=Object(o.resolveComponent)("el-main"),E=Object(o.resolveComponent)("save-dialog"),T=Object(o.resolveComponent)("logs"),$=Object(o.resolveComponent)("el-drawer");return Object(o.openBlock)(),Object(o.createElementBlock)(o.Fragment,null,[Object(o.createVNode)(_,null,{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(y,{gutter:15},{default:Object(o.withCtx)((function(){return[(Object(o.openBlock)(!0),Object(o.createElementBlock)(o.Fragment,null,Object(o.renderList)(p.list,(function(e){return Object(o.openBlock)(),Object(o.createBlock)(k,{xl:6,lg:6,md:8,sm:12,xs:24,key:e.id},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(w,{class:"task task-item",shadow:"hover"},{default:Object(o.withCtx)((function(){return[Object(o.createElementVNode)("h2",null,Object(o.toDisplayString)(e.name)+" 【"+Object(o.toDisplayString)(V.getTypeLabel(e.type))+"】",1),Object(o.createElementVNode)("ul",null,[Object(o.createElementVNode)("li",null,[r,Object(o.createElementVNode)("p",null,Object(o.toDisplayString)(e.target),1)]),Object(o.createElementVNode)("li",null,[l,Object(o.createElementVNode)("p",null,Object(o.toDisplayString)(e.rule),1)])]),Object(o.createElementVNode)("div",a,[Object(o.createElementVNode)("div",i,["0"==e.status?(Object(o.openBlock)(),Object(o.createBlock)(h,{key:0},{default:Object(o.withCtx)((function(){return[u]})),_:1})):Object(o.createCommentVNode)("",!0),"1"==e.status?(Object(o.openBlock)(),Object(o.createBlock)(h,{key:1,type:"info"},{default:Object(o.withCtx)((function(){return[s]})),_:1})):Object(o.createCommentVNode)("",!0)]),Object(o.createElementVNode)("div",d,[Object(o.createVNode)(C,{title:"确定立即执行吗？",onConfirm:function(t){return V.run(e)}},{reference:Object(o.withCtx)((function(){return[Object(o.createVNode)(g,{type:"primary",icon:"el-icon-caret-right",size:"mini",circle:""})]})),_:2},1032,["onConfirm"]),Object(o.createVNode)(v,{trigger:"click"},{dropdown:Object(o.withCtx)((function(){return[Object(o.createVNode)(N,null,{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(x,{onClick:function(t){return V.edit(e)}},{default:Object(o.withCtx)((function(){return[b]})),_:2},1032,["onClick"]),Object(o.createVNode)(x,{onClick:function(t){return V.logs(e)}},{default:Object(o.withCtx)((function(){return[f]})),_:2},1032,["onClick"]),Object(o.createVNode)(x,{onClick:function(t){return V.del(e)},divided:""},{default:Object(o.withCtx)((function(){return[m]})),_:2},1032,["onClick"])]})),_:2},1024)]})),default:Object(o.withCtx)((function(){return[Object(o.createVNode)(g,{type:"primary",icon:"el-icon-more",size:"mini",circle:"",plain:""})]})),_:2},1024)])])]})),_:2},1024)]})),_:2},1024)})),128)),Object(o.createVNode)(k,{xl:6,lg:6,md:8,sm:12,xs:24},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(w,{class:"task task-add",shadow:"none",onClick:V.add},{default:Object(o.withCtx)((function(){return[j,O]})),_:1},8,["onClick"])]})),_:1})]})),_:1})]})),_:1}),p.dialog.save?(Object(o.openBlock)(),Object(o.createBlock)(E,{key:0,ref:"saveDialog",onSuccess:V.handleSuccess,onClosed:t[0]||(t[0]=function(e){return p.dialog.save=!1})},null,8,["onSuccess"])):Object(o.createCommentVNode)("",!0),Object(o.createVNode)($,{title:"计划任务日志",modelValue:p.dialog.logsVisible,"onUpdate:modelValue":t[1]||(t[1]=function(e){return p.dialog.logsVisible=e}),size:1e3,direction:"rtl","destroy-on-close":""},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(T,{ref:"logList"},null,512)]})),_:1},8,["modelValue"])],64)}],["__scopeId","data-v-100d1068"]]);t.default=x}}]);